@inherits LayoutComponentBase
@inject IJSRuntime JS

<MudThemeProvider Theme="@customTheme" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudDrawer @bind-Open="@drawerOpen" Elevation="2" Style="@GetDrawerStyle()">
        <MudDrawerHeader Style="@GetDrawerHeaderStyle()">
            <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                <MudText Typo="Typo.h5" Style="@GetHeaderTextStyle()">FeenQR</MudText>
                <MudIconButton Icon="@GetThemeIcon()" Color="Color.Inherit" OnClick="@ToggleTheme" Size="Size.Small" Style="@GetThemeIconStyle()" />
            </div>
        </MudDrawerHeader>
        
        <MudNavMenu Style="@GetNavMenuStyle()">
            <MudNavLink Href="/" Icon="@Icons.Material.Filled.Home" IconColor="Color.Default">Home</MudNavLink>
            <MudNavLink Href="/dashboard" Icon="@Icons.Material.Filled.Dashboard" IconColor="Color.Default">Dashboard</MudNavLink>
            <MudNavLink Href="/backtesting" Icon="@Icons.Material.Filled.HistoryToggleOff" IconColor="Color.Default">Backtesting</MudNavLink>
            <MudNavLink Href="/execution" Icon="@Icons.Material.Filled.Bolt" IconColor="Color.Default">Execution</MudNavLink>
            <MudNavLink Href="/order-management" Icon="@Icons.Material.Filled.Assignment" IconColor="Color.Default">Order Management</MudNavLink>
            
            <MudDivider Style="margin: 0.75rem 0;" />
            
            <MudText Typo="Typo.caption" Style="padding: 1rem 1rem 0.5rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Analytics</MudText>
            <MudNavLink Href="/technical-analysis" Icon="@Icons.Material.Filled.Timeline" IconColor="Color.Default">Technical Analysis</MudNavLink>
            <MudNavLink Href="/fundamental-analysis" Icon="@Icons.Material.Filled.Assessment" IconColor="Color.Default">Fundamental Analysis</MudNavLink>
            <MudNavLink Href="/risk-analysis" Icon="@Icons.Material.Filled.Security" IconColor="Color.Default">Risk Analysis</MudNavLink>
            <MudNavLink Href="/performance" Icon="@Icons.Material.Filled.TrendingUp" IconColor="Color.Default">Performance Analytics</MudNavLink>
            <MudNavLink Href="/attribution" Icon="@Icons.Material.Filled.PieChart" IconColor="Color.Default">Attribution Analysis</MudNavLink>
            
            <MudDivider Style="margin: 0.75rem 0;" />
            
            <MudText Typo="Typo.caption" Style="padding: 1rem 1rem 0.5rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Machine Learning</MudText>
            <MudNavLink Href="/ml-models" Icon="@Icons.Material.Filled.ModelTraining" IconColor="Color.Default">ML Models</MudNavLink>
            <MudNavLink Href="/factor-research" Icon="@Icons.Material.Filled.Science" IconColor="Color.Default">Factor Research</MudNavLink>
            <MudNavLink Href="/forecasting" Icon="@Icons.Material.Filled.Insights" IconColor="Color.Default">Forecasting</MudNavLink>
            <MudNavLink Href="/anomaly-detection" Icon="@Icons.Material.Filled.BugReport" IconColor="Color.Default">Anomaly Detection</MudNavLink>
            
            <MudDivider Style="margin: 0.75rem 0;" />
            
            <MudText Typo="Typo.caption" Style="padding: 1rem 1rem 0.5rem; color: #9ca3af; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Tools</MudText>
            <MudNavLink Href="/optimizer" Icon="@Icons.Material.Filled.Tune" IconColor="Color.Default">Portfolio Optimizer</MudNavLink>
            <MudNavLink Href="/correlation-matrix" Icon="@Icons.Material.Filled.GridView" IconColor="Color.Default">Correlation Matrix</MudNavLink>
            <MudNavLink Href="/monte-carlo" Icon="@Icons.Material.Filled.Casino" IconColor="Color.Default">Monte Carlo Sim</MudNavLink>
            <MudNavLink Href="/alerts" Icon="@Icons.Material.Filled.NotificationsActive" IconColor="Color.Default">Alerts & Triggers</MudNavLink>
            <MudNavLink Href="/reports" Icon="@Icons.Material.Filled.Description" IconColor="Color.Default">Reports</MudNavLink>
            <MudNavLink Href="/compliance" Icon="@Icons.Material.Filled.Verified" IconColor="Color.Default">Compliance</MudNavLink>
            
            <div Style="padding: 2rem 1rem; margin-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <MudText Typo="Typo.caption" Align="Align.Center" Style="color: #666666;">
                    FeenQR v2.0.0<br/>
                    <span style="font-size: 0.75rem;">Â© 2025 Arithmax Research</span>
                </MudText>
            </div>
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent Style="@GetMainContentStyle()">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool drawerOpen = true;
    private string searchQuery = "";
    private bool isDarkTheme = true;
    
    private void ToggleDrawer()
    {
        drawerOpen = !drawerOpen;
    }

    private async void ToggleTheme()
    {
        isDarkTheme = !isDarkTheme;
        StateHasChanged();
        
        // Notify TradingView chart to update theme
        try
        {
            await JS.InvokeVoidAsync("eval", $"window.currentTheme = '{(isDarkTheme ? "dark" : "light")}';");
        }
        catch { }
    }

    private string GetThemeIcon() => isDarkTheme ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode;

    private string GetThemeIconStyle() => $"color: {(isDarkTheme ? "#ffffff" : "#000000")}";

    private string GetDrawerStyle() => $"width: 280px; background: {(isDarkTheme ? "#000000" : "#ffffff")}; color: {(isDarkTheme ? "#ffffff" : "#000000")}";

    private string GetDrawerHeaderStyle() => $"padding: 1.5rem; background: {(isDarkTheme ? "#000000" : "#ffffff")}; border-bottom: 1px solid {(isDarkTheme ? "rgba(255, 255, 255, 0.1)" : "rgba(0, 0, 0, 0.1)")}";

    private string GetHeaderTextStyle() => $"font-weight: 700; font-family: 'Playfair Display', Georgia, serif; color: {(isDarkTheme ? "#ffffff" : "#000000")}";

    private string GetNavMenuStyle() => $"padding: 0.5rem; background: {(isDarkTheme ? "#000000" : "#ffffff")}; color: {(isDarkTheme ? "#ffffff" : "#000000")}";

    private string GetMainContentStyle() => $"padding: 0; background: {(isDarkTheme ? "#000000" : "#ffffff")}; min-height: 100vh;";
    
    private MudTheme customTheme = new MudTheme
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#888888",
            Secondary = "#888888",
            Success = "#10b981",
            Warning = "#f59e0b",
            Error = "#ef4444",
            Info = "#888888",
            Dark = "#000000",
            Background = "#000000",
            Surface = "#000000",
            AppbarBackground = "#000000",
            DrawerBackground = "#000000",
            TextPrimary = "#f9fafb",
            TextSecondary = "#9ca3af"
        }
    };
}
