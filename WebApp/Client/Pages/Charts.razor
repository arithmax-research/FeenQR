@page "/charts"
@inject IJSRuntime JS

<PageTitle>FeenQR - Advanced Charts</PageTitle>

<style>
    .charts-container {
        padding: 2rem;
        min-height: 100vh;
    }

    .chart-wrapper {
        background: rgba(10, 15, 30, 0.7);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        transform-style: preserve-3d;
        transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .chart-wrapper:hover {
        transform: translateZ(25px);
        border-color: rgba(59, 130, 246, 0.3);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
    }

    .symbol-selector {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .symbol-btn {
        padding: 0.6rem 1.2rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .symbol-btn:hover, .symbol-btn.active {
        background: rgba(59, 130, 246, 0.15);
        border-color: rgba(59, 130, 246, 0.3);
        color: #fff;
    }

    .chart-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #fff;
    }
</style>

<div class="charts-container">
    <div class="chart-title">Interactive Market Charts</div>

    <div class="symbol-selector">
        @foreach (var symbol in symbols)
        {
            <button class="symbol-btn @(selectedSymbol == symbol ? "active" : "")" 
                    @onclick="() => ChangeSymbol(symbol)">
                @symbol
            </button>
        }
    </div>

    <div class="chart-wrapper">
        <div id="tradingViewChart" style="width: 100%; height: 600px;"></div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
        <div class="chart-wrapper">
            <div style="font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 1rem;">
                Technical Indicators
            </div>
            <div id="indicatorsChart" style="width: 100%; height: 400px;"></div>
        </div>

        <div class="chart-wrapper">
            <div style="font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 1rem;">
                Volume Analysis
            </div>
            <div id="volumeChart" style="width: 100%; height: 400px;"></div>
        </div>
    </div>
</div>

@code {
    private string[] symbols = { "AAPL", "NVDA", "TSLA", "MSFT", "GOOGL", "AMZN", "META", "AMD", "INTC" };
    private string selectedSymbol = "AAPL";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await InitializeCharts();
        }
    }

    private async Task InitializeCharts()
    {
        try
        {
            await JS.InvokeVoidAsync("createTradingViewChart", "tradingViewChart", $"NASDAQ:{selectedSymbol}", "D", 600);
            await JS.InvokeVoidAsync("createTradingViewChart", "indicatorsChart", $"NASDAQ:{selectedSymbol}", "D", 400);
            await JS.InvokeVoidAsync("createTradingViewChart", "volumeChart", $"NASDAQ:{selectedSymbol}", "D", 400);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Chart initialization error: {ex.Message}");
        }
    }

    private async Task ChangeSymbol(string symbol)
    {
        selectedSymbol = symbol;
        await InitializeCharts();
        StateHasChanged();
    }
}
