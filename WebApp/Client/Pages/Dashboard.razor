@page "/"
@page "/dashboard"
@inject IJSRuntime JS
@implements IDisposable

<PageTitle>FeenQR - Dashboard</PageTitle>

<style>
    .chart-container {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 280px;
        background: inherit;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    #tradingViewChart {
        width: 100%;
        height: 100%;
    }

    @@media (max-width: 768px) {
        .chart-container {
            left: 0;
        }
    }
</style>

<div class="chart-container">
    <div id="tradingViewChart"></div>
</div>

@code {
    private bool chartInitialized = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !chartInitialized)
        {
            chartInitialized = true;
            await InitializeChart();
            
            // Monitor theme changes via localStorage or use JS interop
            await JS.InvokeVoidAsync("eval", @"
                setInterval(() => {
                    const bgColor = window.getComputedStyle(document.body).backgroundColor;
                    const isBlack = bgColor === 'rgb(0, 0, 0)';
                    const chart = document.getElementById('tradingViewChart');
                    if (chart && chart.dataset.theme !== (isBlack ? 'dark' : 'light')) {
                        chart.dataset.theme = isBlack ? 'dark' : 'light';
                        chart.innerHTML = '';
                        window.createAdvancedChart('tradingViewChart', 'NASDAQ:AAPL', '60');
                    }
                }, 500);
            ");
        }
    }

    private async Task InitializeChart()
    {
        try
        {
            await JS.InvokeVoidAsync("createAdvancedChart", "tradingViewChart", "NASDAQ:AAPL", "60");
            Console.WriteLine("Trading chart initialized");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Chart initialization error: {ex.Message}");
        }
    }

    public void Dispose()
    {
        // Cleanup if needed
    }
}
